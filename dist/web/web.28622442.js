class e extends Error{constructor(e){super(e),this.name=this.constructor.name}}class t extends e{constructor(){super("このコマンドは引数が必要です")}}class n extends e{constructor(){super("このコマンドに引数は不要です")}}class o extends e{constructor(){super("インデントの数が不正です")}}class l extends e{constructor(){super("未知のコマンドです")}}class i extends e{constructor(){super("不適切なelseです")}}class r extends e{constructor(){super("不適切なcaseが現れました")}}class s extends e{constructor(){super("既に同名のCaseが存在します")}}class u extends e{constructor(e){super(`\u{5185}\u{90E8}\u{30A8}\u{30E9}\u{30FC}:${e}`)}}class d{constructor(){this.parent=null,this.depth=0,this.nodeList=[],this.optionStatus="Default",this.optionArg=null}}let h=/^\s*(#.*)?$/,a=()=>!1,c=(e,o)=>{if(e.nodeList.length>0){let t=e.nodeList[e.nodeList.length-1];null!=e.optionArg&&"switch"===t.type&&(t.cases.set(e.optionArg,null),e.optionArg=null)}if(o.startsWith(":")){let u=o.split(/[ \t]+/),d=u[0].substring(1),h=u.length>1?o.substring(u[0].length).trim():null;switch(d){case"call":if(!h)throw new t;e.nodeList.push({type:"call",text:h,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"terminal":if(!h)throw new t;e.nodeList.push({type:"terminal",text:h}),e.optionStatus="Default",e.optionArg=null;break;case"comment":if(!h)throw new t;e.nodeList.push({type:"comment",text:h}),e.optionStatus="Default",e.optionArg=null;break;case"while":if(!h)throw new t;e.nodeList.push({type:"loop",isWhile:!0,text:h,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"dowhile":if(!h)throw new t;e.nodeList.push({type:"loop",isWhile:!1,text:h,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"if":if(!h)throw new t;e.nodeList.push({type:"if",text:h,trueNode:null,falseNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"switch":if(!h)throw new t;e.nodeList.push({type:"switch",text:h,cases:new Map}),e.optionStatus="Default",e.optionArg=null;break;case"else":{let t=0===e.nodeList.length?null:e.nodeList[e.nodeList.length-1];if(null===t||"if"!==t.type)throw new i;if(null!==h)throw new n;e.optionStatus="Else",e.optionArg=null;break}case"case":{let n=0===e.nodeList.length?null:e.nodeList[e.nodeList.length-1];if(null===n||"switch"!==n.type)throw new r;if(!h)throw new t;if(n.cases.has(h))throw new s;e.optionStatus="Default",e.optionArg=h;break}default:throw new l}}else e.nodeList.push({type:"process",text:o,childNode:null}),e.optionStatus="Default",e.optionArg=null},g=e=>{if(null===e)return null;if(e.nodeList.length>0){let t=e.nodeList[e.nodeList.length-1];null!=e.optionArg&&"switch"===t.type&&(t.cases.set(e.optionArg,null),e.optionArg=null)}if(null===e.parent)return null;let t=null;if(0===e.nodeList.length)return e.parent;if(1===e.nodeList.length)t=e.nodeList[0];else{let n={type:"nodeList",children:[]};for(let t=0;t<e.nodeList.length;t++)n.children.push(e.nodeList[t]);t=n}let n=e.parent.nodeList[e.parent.nodeList.length-1];switch(n.type){case"process":case"loop":case"call":n.childNode=t;break;case"switch":if(null!==e.parent.optionArg)n.cases.set(e.parent.optionArg,t);else throw new u("optionArg is null when it shouldn't be for switch node.");break;case"if":if("Default"===e.parent.optionStatus)n.trueNode=t;else if("Else"===e.parent.optionStatus)if(null!==n.falseNode)throw new i;else n.falseNode=t}return e.parent.optionStatus="Default",e.parent.optionArg=null,e.parent},p={fontSize:14,fontFamily:"sans-serif",margin:{top:20,right:20,bottom:20,left:20},boxPadding:{top:10,right:10,bottom:10,left:10},branchePadding:{top:5,right:5,bottom:5,left:5},strokeWidth:1,strokeColor:"#000000",backgroundColor:"#ffffff",baseBackgroundColor:null,textColor:"#000000",lineHeight:1.2,doubleLineWidth:5,switchNodeCaseWidth:20,connectorWidth:2,nodeListSpace:10,childNodeOffsetWidth:20,listRenderType:"original"};function f(e,t){switch(e.type){case"process":return o=e,l=t,w({type:"Process",text:o.text,childNode:o.childNode,borderType:"Box",drawLeftBar:!1,drawRightBar:!1},l);case"terminal":return i=e,r=t,w({type:"Terminal",text:i.text,childNode:null,borderType:"WRound",drawLeftBar:!1,drawRightBar:!1},r);case"nodeList":return s=e,"TerminalOffset"===(u=t).listRenderType?function(e,t){let n=0,o=0,l=0,i=0,r=0,s=0,u="",d=[];for(let l of e.children){let e=f(l,t);d.push(e),n+=e.height,o=Math.max(o,e.width)}let h=d[0];"Terminal"===h.type&&(l=h.width/2);let a=d[d.length-1];if("Terminal"===a.type){let e=a.width/2;e>l?(i=e-l,l=e):r=l-e}for(let e=0;e<d.length;e++){let o=d[e];if(0===e?u+=k(i,s,o.svg):e===d.length-1?u+=k(r,s,o.svg):u+=k(l,s,o.svg),e<d.length-1){let i=0;u+=E(l,i="Terminal"===o.type?0===e?s+o.height:s+o.height/2:s,l,"Terminal"===d[e+1].type?e+1===d.length-1?s+o.height+t.nodeListSpace:s+o.height+t.nodeListSpace+d[e+1].height/2:s+o.height+t.nodeListSpace+d[e+1].height,t),n+=t.nodeListSpace}s+=o.height+t.nodeListSpace}return{svg:u,width:o+l,height:n,type:"NodeList"}}(s,u):function(e,t){let n=0,o=0,l=0,i="",r=[];for(let l of e.children){let e=f(l,t);r.push(e),n+=e.height,o=Math.max(o,e.width)}for(let e=0;e<r.length;e++){let o=r[e];if(i+=k(0,l,o.svg),e<r.length-1){let s=0;i+=E(0,s="Terminal"===o.type?l+o.height/2:l,0,"Terminal"===r[e+1].type?l+o.height+t.nodeListSpace+r[e+1].height/2:l+o.height+t.nodeListSpace+r[e+1].height,t),n+=t.nodeListSpace}l+=o.height+t.nodeListSpace}return{svg:i,width:o,height:n,type:"NodeList"}}(s,u);case"call":return d=e,h=t,w({type:"Call",text:d.text,childNode:d.childNode,borderType:"Box",drawLeftBar:!0,drawRightBar:!0},h);case"loop":return a=e,c=t,w({type:"Loop",text:a.text,childNode:a.childNode,borderType:"Box",drawLeftBar:a.isWhile,drawRightBar:!a.isWhile},c);case"if":let n;return g=e,p=t,n={text:g.text,type:"If",branches:[]},g.trueNode?n.branches.push({label:"",node:g.trueNode}):n.branches.push({label:"",node:null}),g.falseNode?n.branches.push({label:"",node:g.falseNode}):n.branches.push({label:"",node:null}),y(n,p);case"switch":var o,l,i,r,s,u,d,h,a,c,g,p,b,m,L=e,x=t;let B={text:L.text,type:"Switch",branches:[]};for(let[e,t]of L.cases.entries())B.branches.push({label:e.toString(),node:t});return y(B,x);case"comment":return b=e,m=t,w({type:"Comment",text:`(${b.text})`,childNode:null,borderType:"None",drawLeftBar:!1,drawRightBar:!1},m);default:return{svg:"",width:0,height:0,type:"Unknown"}}}function w(e,t){let n=L(e.text,t),o=n.width,l=n.height,i=t.boxPadding.left,r=0,s="";if("Box"===e.borderType){o+=t.boxPadding.left+t.boxPadding.right,l+=t.boxPadding.top+t.boxPadding.bottom,r+=t.boxPadding.top;let e=t.backgroundColor??"none";s+=`<rect x="0" y="0" width="${o}" height="${l}" `,s+=`stroke="${t.strokeColor}" stroke-width="${t.strokeWidth}" `,s+=`fill="${e}"/>`}else if("WRound"===e.borderType){l+=t.boxPadding.top+t.boxPadding.bottom,r+=t.boxPadding.top;let e=l/2;o+=l,i=e;let n=t.backgroundColor??"none";s+=`<rect x="0" y="0" width="${o}" height="${l}" `,s+=`rx="${e}" ry="${e}" `,s+=`stroke="${t.strokeColor}" stroke-width="${t.strokeWidth}" `,s+=`fill="${n}"/>`}else o+=t.boxPadding.left+t.boxPadding.right;e.drawLeftBar&&(s+=E(t.doubleLineWidth,0,t.doubleLineWidth,l,t)),e.drawRightBar&&(s+=E(o-t.doubleLineWidth,0,o-t.doubleLineWidth,l,t)),s+=x(e.text,i,r,t);let u=null;return e.childNode&&(u=f(e.childNode,t),s+=k(t.childNodeOffsetWidth+o,0,u.svg),s+=E(o,0,t.childNodeOffsetWidth+o,0,t)),{svg:s,width:o+(u?u.width+t.childNodeOffsetWidth:0),height:Math.max(l,u?u.height:0),type:e.type}}function b(e,t){let n=L(e,t);return{width:n.width+t.branchePadding.left+t.branchePadding.right,height:n.height+t.branchePadding.top+t.branchePadding.bottom}}function m(e,t,n,o){return x(e,t+o.branchePadding.left,n+o.branchePadding.top,o)}function y(e,t){if(e.branches.length<2)for(;e.branches.length<2;)e.branches.push({label:"",node:null});let n="",o=b(e.text,t),l=o.height,i=0,r=0,s=0,u=0,d=0,h=0,a=[],c=new Map;for(let[n,o]of e.branches.entries()){let g,p,w=o.label,m=b(w,t),y=o.node?f(o.node,t):null,L=y?{width:y.width,height:y.height}:{width:0,height:0};u!==e.branches.length-1&&(L.height+=t.nodeListSpace),a.push({label:w,fragment:y}),i<m.width&&(i=m.width),r<L.width&&(r=L.width),0===u?(g=0,p=m.height):u===e.branches.length-1?(g=m.height,p=0):p=g=m.height/2,d<g&&(d+=g-d);let x=h>g?2*h:2*g;h=p,x>d&&(d=x),s+=d,c.set(n,s),(d=p>L.height?p:L.height)<l&&u<e.branches.length-1&&(d=l),u+=1}s+=d;let g=!0,p=!1,w=[],y=0,L=0+o.width+i+t.switchNodeCaseWidth;for(let[e,o]of(w.push({x:0,y:0}),a.entries())){let l=0+(c.get(e)||0);null!==o.fragment&&(n+=k(L+t.childNodeOffsetWidth,l,o.fragment.svg),n+=E(L,l,L+t.childNodeOffsetWidth,l,t),p=!0),g||w.push({x:L-t.switchNodeCaseWidth,y:(y+l)/2}),w.push({x:L,y:l}),g=!1,y=l}w.push({x:0,y:y});let x=w.map(e=>`${e.x},${e.y}`).join(" "),B=t.backgroundColor??"none";for(let[l,r]of(n+=`<polygon points="${x}" `,n+=`stroke="${t.strokeColor}" `,n+=`stroke-width="${t.strokeWidth}" `,n+=`fill="${B}"/>`,a.entries())){let s=r.label,u=0+(c.get(l)||0),d=b(s,t);l>=e.branches.length-1?u-=d.height:l>0&&(u-=d.height/2),n+=m(s,0+o.width+i-d.width,u,t)}return{svg:n+=m(e.text,0,y/2-o.height/2,t),width:L+r+(p?t.childNodeOffsetWidth:0),height:s,type:e.type}}function L(e,t){let n=e.split("\n"),o=t.fontSize,l=e=>e.match(/^[\u0020-\u007e]*$/)?.6:1;return{width:Math.max(...n.map(e=>{let t=0;for(let n of e)t+=l(n);return t*o})),height:n.length*t.fontSize*t.lineHeight}}function x(e,t,n,o){let l=e.split("\n"),i="";return l.forEach((e,l)=>{let r=0===l?0:l*o.fontSize*o.lineHeight;i+=`<text x="${t}" y="${n+o.fontSize}" dy="${r}" font-family="${o.fontFamily}" font-size="${o.fontSize}" fill="${o.textColor}">${e}</text>`}),i}function E(e,t,n,o,l){return`<line
      x1="${e}" y1="${t}"
      x2="${n}" y2="${o}"
      stroke="${l.strokeColor}"
      stroke-width="${l.strokeWidth}"
    />`}function k(e,t,n){return`<g transform="translate(${e}, ${t})">${n}</g>`}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("spdInput"),n=document.getElementById("svgOutput"),l=document.getElementById("fileInput"),i=document.getElementById("downloadButton"),r=document.getElementById("downloadSvgButton"),s=document.getElementById("fontSizeInput"),u=document.getElementById("baseBackgroundColorInput"),w=document.getElementById("transparentBackgroundCheckbox"),b=document.getElementById("backgroundColorInput"),m=document.getElementById("transparentNodeBackgroundCheckbox"),y=document.getElementById("textColorInput"),L=document.getElementById("listRenderTypeTerminalOffset"),x=document.getElementById("applyOptionsButton"),E=()=>{let l=t.value;try{let t=((t,n=a)=>{let l=new d,i=l,r=t.split(/\r?\n/),s=0;try{for(;s<r.length;){let t=r[s];if(s++,h.test(t))continue;let l=0;for(let e=0;e<t.length;++e)if("	"===t.charAt(e))l++;else break;try{if(null===i||l>0&&0===i.nodeList.length||l<0)throw new o;if(l>i.depth){let e=i.nodeList[i.nodeList.length-1];if(l>i.depth+1||e&&"comment"===e.type||"switch"===e.type&&null==i.optionArg)throw new o;let t=new d;t.parent=i,t.depth=i.depth+1,i=t}for(;l<i.depth;)if(i=g(i),null===i)throw new o;let e=t.substring(l);if(e.endsWith("@")){let t=e.substring(0,e.length-1);for(;s<r.length;){let e=r[s];if(s++,h.test(e))continue;let n=0;for(let t=0;t<e.length;++t)if("	"===e.charAt(t))n++;else break;let o=e.substring(n);if(o.endsWith("@"))t+=`
${o.substring(0,o.length-1)}`;else{t+=`
${o}`;break}}e=t}if(e=e.replace(/@/g,"\n"),null!==i)c(i,e);else throw new o}catch(o){if(o instanceof e)if(n(t,s-1,o));else throw o;else throw o}}for(;null!=i;)i=g(i)}catch(t){if(t instanceof e)throw t;throw console.error(`\u{884C} ${s} \u{3067}\u{4E88}\u{671F}\u{3057}\u{306A}\u{3044}\u{30A8}\u{30E9}\u{30FC}\u{304C}\u{767A}\u{751F}\u{3057}\u{307E}\u{3057}\u{305F}: ${t}`),new e(`\u{4E88}\u{671F}\u{3057}\u{306A}\u{3044}\u{30A8}\u{30E9}\u{30FC}: ${t}`)}return 0===l.nodeList.length?null:{type:"nodeList",children:l.nodeList}})(l),i={fontSize:parseInt(s.value,10),baseBackgroundColor:w.checked?null:u.value,backgroundColor:m.checked?null:b.value,textColor:y.value,listRenderType:L.checked?"TerminalOffset":"Original"};n.innerHTML=function(e,t){let n={...p,...t};if(!e)return"";let o=f(e,n),l=o.width+n.margin.left+n.margin.right,i=o.height+n.margin.top+n.margin.bottom,r="<svg ";r+=`width="${l}" height="${i}" `,r+=`viewBox="0 0 ${l} ${i}" `,r+='xmlns="http://www.w3.org/2000/svg">';let s=n.baseBackgroundColor??"none";return r+='<rect x="0" y="0" ',r+=`width="${l}" height="${i}" `,r+=`fill="${s}"/>`,r+=k(n.margin.left,n.margin.top,o.svg),r+="</svg>"}(t,i)}catch(e){e instanceof Error?(n.innerHTML=`<p style="color: red;">Error: ${e.message}</p>`,console.error("SPD conversion error:",e)):(n.innerHTML='<p style="color: red;">An unknown error occurred</p>',console.error("An unknown error occurred:",e))}};w.addEventListener("change",()=>{u.disabled=w.checked}),m.addEventListener("change",()=>{b.disabled=m.checked}),t.addEventListener("input",E),x.addEventListener("click",E),t.addEventListener("keydown",e=>{if("Tab"===e.key){e.preventDefault();let n=t.selectionStart,o=t.selectionEnd;t.value=t.value.substring(0,n)+"	"+t.value.substring(o),t.selectionStart=t.selectionEnd=n+1,E()}}),l.addEventListener("change",e=>{let n=e.target.files?.[0];if(n){let e=new FileReader;e.onload=e=>{t.value=e.target?.result,E()},e.readAsText(n)}}),i.addEventListener("click",()=>{let e=t.value,n=prompt("ダウンロードするファイル名を入力してください:","edited_spd.spd");if(null===n)return;n.endsWith(".spd")||(n+=".spd");let o=new Blob([e],{type:"text/plain"}),l=URL.createObjectURL(o),i=document.createElement("a");i.href=l,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}),r.addEventListener("click",()=>{let e=n.innerHTML;if(!e)return void alert("SVGが生成されていません。");let t=prompt("ダウンロードするSVGファイル名を入力してください:","output.svg");if(null===t)return;t.endsWith(".svg")||(t+=".svg");let o=new Blob([e],{type:"image/svg+xml"}),l=URL.createObjectURL(o),i=document.createElement("a");i.href=l,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}),t.value=`:terminal \u{958B}\u{59CB}
\u{547D}\u{4EE4}
:comment \u{30B3}\u{30E1}\u{30F3}\u{30C8}\u{6587}
:call \u{95A2}\u{6570}\u{547C}\u{3073}\u{51FA}\u{3057}
	\u{4E2D}\u{8EAB}
:if \u{6761}\u{4EF6}\u{5F0F}
	\u{771F}\u{306E}\u{5834}\u{5408}
:else
	\u{507D}\u{306E}\u{5834}\u{5408}(:else\u{4EE5}\u{4E0B}\u{306F}\u{7701}\u{7565}\u{53EF}\u{80FD})
:switch \u{6761}\u{4EF6}
:case \u{30B1}\u{30FC}\u{30B9}1
	\u{30B1}\u{30FC}\u{30B9}1\u{306E}\u{4E2D}\u{8EAB}
:case \u{30B1}\u{30FC}\u{30B9}2
	\u{30B1}\u{30FC}\u{30B9}2\u{306E}\u{4E2D}\u{8EAB}
:case ...
	\u{30B1}\u{30FC}\u{30B9}\u{6587}\u{306F}\u{5FC5}\u{8981}\u{306B}\u{5FDC}\u{3058}\u{3066}\u{3044}\u{304F}\u{3064}\u{3067}\u{3082}\u{8FFD}\u{52A0}\u{3067}\u{304D}\u{307E}\u{3059}
:while \u{7E70}\u{308A}\u{8FD4}\u{3057}\u{6761}\u{4EF6}\u{FF08}\u{5148}\u{5224}\u{5B9A}\u{FF09}
	\u{4E2D}\u{8EAB}
:dowhile \u{7E70}\u{308A}\u{8FD4}\u{3057}\u{6761}\u{4EF6}\u{FF08}\u{5F8C}\u{5224}\u{5B9A}\u{FF09}
	\u{4E2D}\u{8EAB}
:terminal \u{7D42}\u{4E86}`,E()});
//# sourceMappingURL=web.28622442.js.map
