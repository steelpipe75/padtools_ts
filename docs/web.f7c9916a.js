class e extends Error{constructor(e){super(e),this.name=this.constructor.name}}class t extends e{constructor(){super("このコマンドは引数が必要です")}}class n extends e{constructor(){super("このコマンドに引数は不要です")}}class o extends e{constructor(){super("インデントの数が不正です")}}class l extends e{constructor(){super("未知のコマンドです")}}class i extends e{constructor(){super("不適切なelseです")}}class r extends e{constructor(){super("不適切なcaseが現れました")}}class u extends e{constructor(){super("既に同名のCaseが存在します")}}class s{constructor(){this.parent=null,this.depth=0,this.nodeList=[],this.optionStatus="Default",this.optionArg=null}}class d{static{this.patternComment=/^\s*(#.*)?$/}static{this.DummyParseErrorReceiver=()=>!1}static handleBody(e,o){if(e.nodeList.length>0){let t=e.nodeList[e.nodeList.length-1];null!=e.optionArg&&"switch"===t.type&&(t.cases.set(e.optionArg,null),e.optionArg=null)}if(o.startsWith(":")){let s=o.split(/[ \t]+/),d=s[0].substring(1),a=s.length>1?o.substring(s[0].length).trim():null;switch(d){case"call":if(!a)throw new t;e.nodeList.push({type:"call",text:a,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"terminal":if(!a)throw new t;e.nodeList.push({type:"terminal",text:a}),e.optionStatus="Default",e.optionArg=null;break;case"comment":if(!a)throw new t;e.nodeList.push({type:"comment",text:a}),e.optionStatus="Default",e.optionArg=null;break;case"while":if(!a)throw new t;e.nodeList.push({type:"loop",isWhile:!0,text:a,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"dowhile":if(!a)throw new t;e.nodeList.push({type:"loop",isWhile:!1,text:a,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"if":if(!a)throw new t;e.nodeList.push({type:"if",text:a,trueNode:null,falseNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"switch":if(!a)throw new t;e.nodeList.push({type:"switch",text:a,cases:new Map}),e.optionStatus="Default",e.optionArg=null;break;case"else":let h=0===e.nodeList.length?null:e.nodeList[e.nodeList.length-1];if(null===h||"if"!==h.type)throw new i;if(null!==a)throw new n;e.optionStatus="Else",e.optionArg=null;break;case"case":let c=0===e.nodeList.length?null:e.nodeList[e.nodeList.length-1];if(null===c||"switch"!==c.type)throw new r;if(!a)throw new t;if(c.cases.has(a))throw new u;e.optionStatus="Default",e.optionArg=a;break;default:throw new l}}else e.nodeList.push({type:"process",text:o,childNode:null}),e.optionStatus="Default",e.optionArg=null}static upToParent(e){if(null===e)return null;if(e.nodeList.length>0){let t=e.nodeList[e.nodeList.length-1];null!=e.optionArg&&"switch"===t.type&&(t.cases.set(e.optionArg,null),e.optionArg=null)}if(null===e.parent)return null;let t=null;if(0==e.nodeList.length)return e.parent;if(1==e.nodeList.length)t=e.nodeList[0];else{let n={type:"nodeList",children:[]};for(let t=0;t<e.nodeList.length;t++)n.children.push(e.nodeList[t]);t=n}let n=e.parent.nodeList[e.parent.nodeList.length-1];switch(n.type){case"process":case"loop":case"call":n.childNode=t;break;case"switch":n.cases.set(e.parent.optionArg,t);break;case"if":if("Default"===e.parent.optionStatus)n.trueNode=t;else if("Else"===e.parent.optionStatus)if(null!==n.falseNode)throw new i;else n.falseNode=t}return e.parent.optionStatus="Default",e.parent.optionArg=null,e.parent}static parse(t,n=d.DummyParseErrorReceiver){let l=new s,i=l,r=t.split(/\r?\n/),u=0;try{for(;u<r.length;){let t=r[u];if(u++,d.patternComment.test(t))continue;let l=0;for(let e=0;e<t.length;++e)if("	"===t.charAt(e))l++;else break;try{if(null===i||l>0&&0==i.nodeList.length||l<0)throw new o;if(l>i.depth){let e=i.nodeList[i.nodeList.length-1];if(l>i.depth+1||e&&"comment"===e.type||"switch"===e.type&&null==i.optionArg)throw new o;let t=new s;t.parent=i,t.depth=i.depth+1,i=t}for(;l<i.depth;)if(i=d.upToParent(i),null===i)throw new o;let e=t.substring(l);if(e.endsWith("@")){let t=e.substring(0,e.length-1);for(;u<r.length;){let e=r[u];if(u++,d.patternComment.test(e))continue;let n=0;for(let t=0;t<e.length;++t)if("	"===e.charAt(t))n++;else break;let o=e.substring(n);if(o.endsWith("@"))t+="\n"+o.substring(0,o.length-1);else{t+="\n"+o;break}}e=t}e=e.replace(/@/g,"\n"),d.handleBody(i,e)}catch(o){if(o instanceof e&&n(t,u-1,o))continue;throw o}}for(;null!=i;)i=d.upToParent(i)}catch(t){if(t instanceof e)throw t;throw console.error(`\u{884C} ${u} \u{3067}\u{4E88}\u{671F}\u{3057}\u{306A}\u{3044}\u{30A8}\u{30E9}\u{30FC}\u{304C}\u{767A}\u{751F}\u{3057}\u{307E}\u{3057}\u{305F}: ${t}`),new e(`\u{4E88}\u{671F}\u{3057}\u{306A}\u{3044}\u{30A8}\u{30E9}\u{30FC}: ${t}`)}return 0===l.nodeList.length?null:{type:"nodeList",children:l.nodeList}}}let a={fontSize:14,fontFamily:"sans-serif",margin:{top:20,right:20,bottom:20,left:20},boxPadding:{top:10,right:10,bottom:10,left:10},branchePadding:{top:5,right:5,bottom:5,left:5},strokeWidth:1,strokeColor:"#000000",backgroundColor:"#ffffff",baseBackgroundColor:null,textColor:"#000000",lineHeight:1.2,doubleLineWidth:5,switchNodeCaseWidth:20,connectorWidth:2,nodeListSpace:10,childNodeOffsetWidth:20};function h(e,t){switch(e.type){case"process":return o=e,l=t,c({type:"Process",text:o.text,childNode:o.childNode,borderType:"Box",drawLeftBar:!1,drawRightBar:!1},l);case"terminal":return i=e,r=t,c({type:"Terminal",text:i.text,childNode:null,borderType:"WRound",drawLeftBar:!1,drawRightBar:!1},r);case"nodeList":return function(e,t){let n=0,o=0,l=0,i="",r=[];for(let l of e.children){let e=h(l,t);r.push(e),n+=e.height,o=Math.max(o,e.width)}for(let e=0;e<r.length;e++){let o=r[e];if(i+=y(0,l,o.svg),e<r.length-1){let u=0;i+=m(0,u="Terminal"===o.type?l+o.height/2:l,0,"Terminal"===r[e+1].type?l+o.height+t.nodeListSpace+r[e+1].height/2:l+o.height+t.nodeListSpace+r[e+1].height,t),n+=t.nodeListSpace}l+=o.height+t.nodeListSpace}return{svg:i,width:o,height:n,type:"NodeList"}}(e,t);case"call":return u=e,s=t,c({type:"Call",text:u.text,childNode:u.childNode,borderType:"Box",drawLeftBar:!0,drawRightBar:!0},s);case"loop":return d=e,a=t,c({type:"Loop",text:d.text,childNode:d.childNode,borderType:"Box",drawLeftBar:d.isWhile,drawRightBar:!d.isWhile},a);case"if":let n;return p=e,g=t,n={text:p.text,type:"If",branches:[]},p.trueNode?n.branches.push({label:"",node:p.trueNode}):n.branches.push({label:"",node:null}),p.falseNode?n.branches.push({label:"",node:p.falseNode}):n.branches.push({label:"",node:null}),f(n,g);case"switch":var o,l,i,r,u,s,d,a,p,g,w,b,x=e,L=t;let E={text:x.text,type:"Switch",branches:[]};for(let[e,t]of x.cases.entries())E.branches.push({label:e.toString(),node:t});return f(E,L);case"comment":return w=e,b=t,c({type:"Comment",text:"("+w.text+")",childNode:null,borderType:"None",drawLeftBar:!1,drawRightBar:!1},b);default:return{svg:"",width:0,height:0,type:"Unknown"}}}function c(e,t){let n=w(e.text,t),o=n.width,l=n.height,i=t.boxPadding.left,r=0,u="";if("Box"===e.borderType){o+=t.boxPadding.left+t.boxPadding.right,l+=t.boxPadding.top+t.boxPadding.bottom,r+=t.boxPadding.top;let e=t.backgroundColor??"none";u+=`<rect x="0" y="0" width="${o}" height="${l}" `,u+=`stroke="${t.strokeColor}" stroke-width="${t.strokeWidth}" `,u+=`fill="${e}"/>`}else if("WRound"===e.borderType){l+=t.boxPadding.top+t.boxPadding.bottom,r+=t.boxPadding.top;let e=l/2;o+=l,i=e;let n=t.backgroundColor??"none";u+=`<rect x="0" y="0" width="${o}" height="${l}" `,u+=`rx="${e}" ry="${e}" `,u+=`stroke="${t.strokeColor}" stroke-width="${t.strokeWidth}" `,u+=`fill="${n}"/>`}else o+=t.boxPadding.left+t.boxPadding.right;e.drawLeftBar&&(u+=m(t.doubleLineWidth,0,t.doubleLineWidth,l,t)),e.drawRightBar&&(u+=m(o-t.doubleLineWidth,0,o-t.doubleLineWidth,l,t)),u+=b(e.text,i,r,t);let s=null;return e.childNode&&(s=h(e.childNode,t),u+=y(t.childNodeOffsetWidth+o,0,s.svg),u+=m(o,0,t.childNodeOffsetWidth+o,0,t)),{svg:u,width:o+(s?s.width+t.childNodeOffsetWidth:0),height:Math.max(l,s?s.height:0),type:e.type}}function p(e,t){let n=w(e,t);return{width:n.width+t.branchePadding.left+t.branchePadding.right,height:n.height+t.branchePadding.top+t.branchePadding.bottom}}function g(e,t,n,o){return b(e,t+o.branchePadding.left,n+o.branchePadding.top,o)}function f(e,t){if(e.branches.length<2)for(;e.branches.length<2;)e.branches.push({label:"",node:null});let n="",o=p(e.text,t),l=o.height,i=0,r=0,u=0,s=0,d=0,a=0,c=[],f=new Map;for(let[n,o]of e.branches.entries()){let g,w,b=o.label,m=p(b,t),y=o.node?h(o.node,t):null,x=y?{width:y.width,height:y.height}:{width:0,height:0};s!==e.branches.length-1&&(x.height+=t.nodeListSpace),c.push({label:b,fragment:y}),i<m.width&&(i=m.width),r<x.width&&(r=x.width),0===s?(g=0,w=m.height):s===e.branches.length-1?(g=m.height,w=0):w=g=m.height/2,d<g&&(d+=g-d);let L=a>g?2*a:2*g;a=w,L>d&&(d=L),u+=d,f.set(n,u),(d=w>x.height?w:x.height)<l&&s<e.branches.length-1&&(d=l),s+=1}u+=d;let w=!0,b=!1,x=[],L=0,E=0+o.width+i+t.switchNodeCaseWidth;for(let[e,o]of(x.push({x:0,y:0}),c.entries())){let l=0+(f.get(e)||0);null!==o.fragment&&(n+=y(E+t.childNodeOffsetWidth,l,o.fragment.svg),n+=m(E,l,E+t.childNodeOffsetWidth,l,t),b=!0),w||x.push({x:E-t.switchNodeCaseWidth,y:(L+l)/2}),x.push({x:E,y:l}),w=!1,L=l}x.push({x:0,y:L});let B=x.map(e=>`${e.x},${e.y}`).join(" "),k=t.backgroundColor??"none";for(let[l,r]of(n+=`<polygon points="${B}" `,n+=`stroke="${t.strokeColor}" `,n+=`stroke-width="${t.strokeWidth}" `,n+=`fill="${k}"/>`,c.entries())){let u=r.label,s=0+(f.get(l)||0),d=p(u,t);l>=e.branches.length-1?s-=d.height:l>0&&(s-=d.height/2),n+=g(u,0+o.width+i-d.width,s,t)}return{svg:n+=g(e.text,0,L/2-o.height/2,t),width:E+r+(b?t.childNodeOffsetWidth:0),height:u,type:e.type}}function w(e,t){let n=e.split("\n"),o=t.fontSize,l=e=>e.match(/^[\u0000-\u007e]*$/)?.6:1;return{width:Math.max(...n.map(e=>{let t=0;for(let n of e)t+=l(n);return t*o})),height:n.length*t.fontSize*t.lineHeight}}function b(e,t,n,o){let l=e.split("\n"),i="";return l.forEach((e,l)=>{let r=0===l?0:l*o.fontSize*o.lineHeight;i+=`<text x="${t}" y="${n+o.fontSize}" dy="${r}" font-family="${o.fontFamily}" font-size="${o.fontSize}" fill="${o.textColor}">${e}</text>`}),i}function m(e,t,n,o,l){return`<line
      x1="${e}" y1="${t}"
      x2="${n}" y2="${o}"
      stroke="${l.strokeColor}"
      stroke-width="${l.strokeWidth}"
    />`}function y(e,t,n){return`<g transform="translate(${e}, ${t})">${n}</g>`}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("spdInput"),t=document.getElementById("svgOutput"),n=document.getElementById("fileInput"),o=document.getElementById("downloadButton"),l=document.getElementById("downloadSvgButton"),i=document.getElementById("fontSizeInput"),r=document.getElementById("baseBackgroundColorInput"),u=document.getElementById("transparentBackgroundCheckbox"),s=document.getElementById("backgroundColorInput"),c=document.getElementById("transparentNodeBackgroundCheckbox"),p=document.getElementById("textColorInput"),g=document.getElementById("applyOptionsButton");u.addEventListener("change",()=>{r.disabled=u.checked,f()}),c.addEventListener("change",()=>{s.disabled=c.checked,f()});let f=()=>{let n=e.value;try{let e=d.parse(n),o={fontSize:parseInt(i.value),baseBackgroundColor:u.checked?null:r.value,backgroundColor:c.checked?null:s.value,textColor:p.value};t.innerHTML=function(e,t){let n={...a,...t};if(!e)return"";let o=h(e,n),l=o.width+n.margin.left+n.margin.right,i=o.height+n.margin.top+n.margin.bottom,r="<svg ";r+=`width="${l}" height="${i}" `,r+=`viewBox="0 0 ${l} ${i}" `,r+='xmlns="http://www.w3.org/2000/svg">';let u=n.baseBackgroundColor??"none";return r+='<rect x="0" y="0" ',r+=`width="${l}" height="${i}" `,r+=`fill="${u}"/>`,r+=y(n.margin.left,n.margin.top,o.svg),r+="</svg>"}(e,o)}catch(e){t.innerHTML=`<p style="color: red;">Error: ${e.message}</p>`,console.error("SPD conversion error:",e)}};e.addEventListener("input",f),g.addEventListener("click",f),e.addEventListener("keydown",t=>{if("Tab"===t.key){t.preventDefault();let n=e.selectionStart,o=e.selectionEnd;e.value=e.value.substring(0,n)+"	"+e.value.substring(o),e.selectionStart=e.selectionEnd=n+1,f()}}),n.addEventListener("change",t=>{let n=t.target.files?.[0];if(n){let t=new FileReader;t.onload=t=>{e.value=t.target?.result,f()},t.readAsText(n)}}),o.addEventListener("click",()=>{let t=e.value,n=prompt("ダウンロードするファイル名を入力してください:","edited_spd.spd");if(null===n)return;n.endsWith(".spd")||(n+=".spd");let o=new Blob([t],{type:"text/plain"}),l=URL.createObjectURL(o),i=document.createElement("a");i.href=l,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}),l.addEventListener("click",()=>{let e=t.innerHTML;if(!e)return void alert("SVGが生成されていません。");let n=prompt("ダウンロードするSVGファイル名を入力してください:","output.svg");if(null===n)return;n.endsWith(".svg")||(n+=".svg");let o=new Blob([e],{type:"image/svg+xml"}),l=URL.createObjectURL(o),i=document.createElement("a");i.href=l,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}),e.value=`:terminal \u{958B}\u{59CB}
\u{547D}\u{4EE4}
:comment \u{30B3}\u{30E1}\u{30F3}\u{30C8}\u{6587}
:call \u{95A2}\u{6570}\u{547C}\u{3073}\u{51FA}\u{3057}
	\u{4E2D}\u{8EAB}
:if \u{6761}\u{4EF6}\u{5F0F}
	\u{771F}\u{306E}\u{5834}\u{5408}
:else
	\u{507D}\u{306E}\u{5834}\u{5408}(:else\u{4EE5}\u{4E0B}\u{306F}\u{7701}\u{7565}\u{53EF}\u{80FD})
:switch \u{6761}\u{4EF6}
:case \u{30B1}\u{30FC}\u{30B9}1
	\u{30B1}\u{30FC}\u{30B9}1\u{306E}\u{4E2D}\u{8EAB}
:case \u{30B1}\u{30FC}\u{30B9}2
	\u{30B1}\u{30FC}\u{30B9}2\u{306E}\u{4E2D}\u{8EAB}
:case ...
	\u{30B1}\u{30FC}\u{30B9}\u{6587}\u{306F}\u{5FC5}\u{8981}\u{306B}\u{5FDC}\u{3058}\u{3066}\u{3044}\u{304F}\u{3064}\u{3067}\u{3082}\u{8FFD}\u{52A0}\u{3067}\u{304D}\u{307E}\u{3059}
:while \u{7E70}\u{308A}\u{8FD4}\u{3057}\u{6761}\u{4EF6}\u{FF08}\u{5148}\u{5224}\u{5B9A}\u{FF09}
	\u{4E2D}\u{8EAB}
:dowhile \u{7E70}\u{308A}\u{8FD4}\u{3057}\u{6761}\u{4EF6}\u{FF08}\u{5F8C}\u{5224}\u{5B9A}\u{FF09}
	\u{4E2D}\u{8EAB}
:terminal \u{7D42}\u{4E86}`,f()});
//# sourceMappingURL=web.f7c9916a.js.map
