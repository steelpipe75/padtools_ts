class e extends Error{constructor(e){super(e),this.name=this.constructor.name}}class t extends e{constructor(){super("このコマンドは引数が必要です")}}class n extends e{constructor(){super("このコマンドに引数は不要です")}}class o extends e{constructor(){super("インデントの数が不正です")}}class i extends e{constructor(){super("未知のコマンドです")}}class l extends e{constructor(){super("不適切なelseです")}}class r extends e{constructor(){super("不適切なcaseが現れました")}}class s extends e{constructor(){super("既に同名のCaseが存在します")}}class d extends e{constructor(e){super("内部エラー:"+e)}}class h{constructor(){this.parent=null,this.depth=0,this.nodeList=[],this.optionStatus="Default",this.optionArg=null}}class a{static{this.patternComment=/^\s*(#.*)?$/}static{this.DummyParseErrorReceiver=()=>!1}static handleBody(e,o){if(e.nodeList.length>0){let t=e.nodeList[e.nodeList.length-1];null!=e.optionArg&&"switch"===t.type&&(t.cases.set(e.optionArg,null),e.optionArg=null)}if(o.startsWith(":")){let d=o.split(/[ \t]+/),h=d[0].substring(1),a=d.length>1?o.substring(d[0].length).trim():null;switch(h){case"call":if(!a)throw new t;e.nodeList.push({type:"call",text:a,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"terminal":if(!a)throw new t;e.nodeList.push({type:"terminal",text:a}),e.optionStatus="Default",e.optionArg=null;break;case"comment":if(!a)throw new t;e.nodeList.push({type:"comment",text:a}),e.optionStatus="Default",e.optionArg=null;break;case"while":if(!a)throw new t;e.nodeList.push({type:"loop",isWhile:!0,text:a,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"dowhile":if(!a)throw new t;e.nodeList.push({type:"loop",isWhile:!1,text:a,childNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"if":if(!a)throw new t;e.nodeList.push({type:"if",text:a,trueNode:null,falseNode:null}),e.optionStatus="Default",e.optionArg=null;break;case"switch":if(!a)throw new t;e.nodeList.push({type:"switch",text:a,cases:new Map}),e.optionStatus="Default",e.optionArg=null;break;case"else":let u=0===e.nodeList.length?null:e.nodeList[e.nodeList.length-1];if(null===u||"if"!==u.type)throw new l;if(null!==a)throw new n;e.optionStatus="Else",e.optionArg=null;break;case"case":let c=0===e.nodeList.length?null:e.nodeList[e.nodeList.length-1];if(null===c||"switch"!==c.type)throw new r;if(!a)throw new t;if(c.cases.has(a))throw new s;e.optionStatus="Default",e.optionArg=a;break;default:throw new i}}else e.nodeList.push({type:"process",text:o,childNode:null}),e.optionStatus="Default",e.optionArg=null}static upToParent(e){if(null===e)return null;if(e.nodeList.length>0){let t=e.nodeList[e.nodeList.length-1];null!=e.optionArg&&"switch"===t.type&&(t.cases.set(e.optionArg,null),e.optionArg=null)}if(null===e.parent)return null;let t=null;if(0==e.nodeList.length)return e.parent;if(1==e.nodeList.length)t=e.nodeList[0];else if(e.nodeList.length>1){let n={type:"nodeList",children:[]};for(let t=0;t<e.nodeList.length;t++)n.children.push(e.nodeList[t]);t=n}else throw new d("Parent node is not found");let n=e.parent.nodeList[e.parent.nodeList.length-1];switch(n.type){case"process":case"loop":case"call":n.childNode=t;break;case"switch":n.cases.set(e.parent.optionArg,t);break;case"if":if("Default"===e.parent.optionStatus)n.trueNode=t;else if("Else"===e.parent.optionStatus)if(null!==n.falseNode)throw new l;else n.falseNode=t;else throw new d("Illegal option status");break;default:throw new d("Illegal command")}return e.parent.optionStatus="Default",e.parent.optionArg=null,e.parent}static parse(t,n=a.DummyParseErrorReceiver){let i=new h,l=i,r=t.split(/\r?\n/),s=0;try{for(;s<r.length;){let t=r[s];if(s++,a.patternComment.test(t))continue;let i=0;for(let e=0;e<t.length;++e)if("	"===t.charAt(e))i++;else break;try{if(null===l||i>0&&0==l.nodeList.length||i<0)throw new o;if(i>l.depth){let e=l.nodeList[l.nodeList.length-1];if(i>l.depth+1||e&&"comment"===e.type||"switch"===e.type&&null==l.optionArg)throw new o;let t=new h;t.parent=l,t.depth=l.depth+1,l=t}for(;i<l.depth;)if(l=a.upToParent(l),null===l)throw new o;let e=t.substring(i);if(e.endsWith("@")){let t=e.substring(0,e.length-1);for(;s<r.length;){let e=r[s];if(s++,a.patternComment.test(e))continue;let n=0;for(let t=0;t<e.length;++t)if("	"===e.charAt(t))n++;else break;let o=e.substring(n);if(o.endsWith("@"))t+="\n"+o.substring(0,o.length-1);else{t+="\n"+o;break}}e=t}e=e.replace(/@/g,"\n"),a.handleBody(l,e)}catch(o){if(o instanceof e&&n(t,s-1,o))continue;throw o}}for(;null!=l;)l=a.upToParent(l)}catch(t){if(t instanceof e)throw t;throw console.error(`\u{884C} ${s} \u{3067}\u{4E88}\u{671F}\u{3057}\u{306A}\u{3044}\u{30A8}\u{30E9}\u{30FC}\u{304C}\u{767A}\u{751F}\u{3057}\u{307E}\u{3057}\u{305F}: ${t}`),new e(`\u{4E88}\u{671F}\u{3057}\u{306A}\u{3044}\u{30A8}\u{30E9}\u{30FC}: ${t}`)}return 0===i.nodeList.length?null:{type:"nodeList",children:i.nodeList}}}const u={fontSize:14,fontFamily:"sans-serif",margin:{top:20,right:20,bottom:20,left:20},boxPadding:{top:10,right:10,bottom:10,left:10},branchePadding:{top:5,right:5,bottom:5,left:5},strokeWidth:1,strokeColor:"#000000",backgroundColor:"#ffffff",textColor:"#000000",lineHeight:1.2,doubleLineWidth:5,switchNodeCaseWidth:20,connectorWidth:2,nodeListSpace:10,childNodeOffsetWidth:20};function c(e,t){switch(e.type){case"process":return o=e,i=t,p({type:"Process",text:o.text,childNode:o.childNode,borderType:"Box",drawLeftBar:!1,drawRightBar:!1},i);case"terminal":return l=e,r=t,p({type:"Terminal",text:l.text,childNode:null,borderType:"WRound",drawLeftBar:!1,drawRightBar:!1},r);case"nodeList":return function(e,t){let n=0,o=0,i=0,l="",r=[];for(let i of e.children){let e=c(i,t);r.push(e),n+=e.height,o=Math.max(o,e.width)}for(let e=0;e<r.length;e++){let o=r[e];if(l+=x(0,i,o.svg),e<r.length-1){let s=0;l+=y(0,s="Terminal"===o.type?i+o.height/2:i,0,"Terminal"===r[e+1].type?i+o.height+t.nodeListSpace+r[e+1].height/2:i+o.height+t.nodeListSpace+r[e+1].height,t),n+=t.nodeListSpace}i+=o.height+t.nodeListSpace}return{svg:l,width:o,height:n,type:"NodeList"}}(e,t);case"call":return s=e,d=t,p({type:"Call",text:s.text,childNode:s.childNode,borderType:"Box",drawLeftBar:!0,drawRightBar:!0},d);case"loop":return h=e,a=t,p({type:"Loop",text:h.text,childNode:h.childNode,borderType:"Box",drawLeftBar:h.isWhile,drawRightBar:!h.isWhile},a);case"if":let n;return u=e,g=t,n={text:u.text,type:"If",branches:[]},u.trueNode?n.branches.push({label:"",node:u.trueNode}):n.branches.push({label:"",node:null}),u.falseNode?n.branches.push({label:"",node:u.falseNode}):n.branches.push({label:"",node:null}),w(n,g);case"switch":var o,i,l,r,s,d,h,a,u,g,f,b,m=e,L=t;let k={text:m.text,type:"Switch",branches:[]};for(let[e,t]of m.cases.entries())k.branches.push({label:e.toString(),node:t});return w(k,L);case"comment":return f=e,b=t,p({type:"Comment",text:"("+f.text+")",childNode:null,borderType:"None",drawLeftBar:!1,drawRightBar:!1},b);default:return{svg:"",width:0,height:0,type:"Unknown"}}}function p(e,t){let n=b(e.text,t),o=n.width,i=n.height,l=t.boxPadding.left,r=0,s="";if("Box"===e.borderType)o+=t.boxPadding.left+t.boxPadding.right,i+=t.boxPadding.top+t.boxPadding.bottom,r+=t.boxPadding.top,s+=`<rect x="0" y="0" width="${o}" height="${i}"
      stroke="${t.strokeColor}" stroke-width="${t.strokeWidth}"
      fill="${t.backgroundColor}"/>`;else if("WRound"===e.borderType){i+=t.boxPadding.top+t.boxPadding.bottom,r+=t.boxPadding.top;let e=i/2;o+=i,l=e,s+=`<rect x="0" y="0" width="${o}" height="${i}"
      rx="${e}" ry="${e}"
      stroke="${t.strokeColor}" stroke-width="${t.strokeWidth}"
      fill="${t.backgroundColor}"/>`}else o+=t.boxPadding.left+t.boxPadding.right;e.drawLeftBar&&(s+=y(t.doubleLineWidth,0,t.doubleLineWidth,i,t)),e.drawRightBar&&(s+=y(o-t.doubleLineWidth,0,o-t.doubleLineWidth,i,t)),s+=m(e.text,l,r,t);let d=null;return e.childNode&&(d=c(e.childNode,t),s+=x(t.childNodeOffsetWidth+o,0,d.svg),s+=y(o,0,t.childNodeOffsetWidth+o,0,t)),{svg:s,width:o+(d?d.width+t.childNodeOffsetWidth:0),height:Math.max(i,d?d.height:0),type:e.type}}function g(e,t){let n=b(e,t);return{width:n.width+t.branchePadding.left+t.branchePadding.right,height:n.height+t.branchePadding.top+t.branchePadding.bottom}}function f(e,t,n,o){return m(e,t+o.branchePadding.left,n+o.branchePadding.top,o)}function w(e,t){if(e.branches.length<2)for(;e.branches.length<2;)e.branches.push({label:"",node:null});let n="",o=g(e.text,t),i=o.height,l=0,r=0,s=0,d=0,h=0,a=0,u=[],p=new Map;for(let[n,o]of e.branches.entries()){let f,w,b=o.label,m=g(b,t),y=o.node?c(o.node,t):null,x=y?{width:y.width,height:y.height}:{width:0,height:0};d!==e.branches.length-1&&(x.height+=t.nodeListSpace),u.push({label:b,fragment:y}),l<m.width&&(l=m.width),r<x.width&&(r=x.width),0===d?(f=0,w=m.height):d===e.branches.length-1?(f=m.height,w=0):w=f=m.height/2,h<f&&(h+=f-h);let L=a>f?2*a:2*f;a=w,L>h&&(h=L),s+=h,p.set(n,s),(h=w>x.height?w:x.height)<i&&d<e.branches.length-1&&(h=i),d+=1}s+=h;let w=!0,b=!1,m=[],L=0,k=0+o.width+l+t.switchNodeCaseWidth;for(let[e,o]of(m.push({x:0,y:0}),u.entries())){let i=0+(p.get(e)||0);null!==o.fragment&&(n+=x(k+t.childNodeOffsetWidth,i,o.fragment.svg),n+=y(k,i,k+t.childNodeOffsetWidth,i,t),b=!0),w||m.push({x:k-t.switchNodeCaseWidth,y:(L+i)/2}),m.push({x:k,y:i}),w=!1,L=i}m.push({x:0,y:L});let $=m.map(e=>`${e.x},${e.y}`).join(" ");for(let[i,r]of(n+=`<polygon points="${$}"
    stroke="${t.strokeColor}"
    stroke-width="${t.strokeWidth}"
    fill="${t.backgroundColor}"/>`,u.entries())){let s=r.label,d=0+(p.get(i)||0),h=g(s,t);i>=e.branches.length-1?d-=h.height:i>0&&(d-=h.height/2),n+=f(s,0+o.width+l-h.width,d,t)}return{svg:n+=f(e.text,0,L/2-o.height/2,t),width:k+r+(b?t.childNodeOffsetWidth:0),height:s,type:e.type}}function b(e,t){let n=e.split("\n"),o=t.fontSize,i=e=>e.match(/^[\u0000-\u007e]*$/)?.6:1;return{width:Math.max(...n.map(e=>{let t=0;for(let n of e)t+=i(n);return t*o})),height:n.length*t.fontSize*t.lineHeight}}function m(e,t,n,o){let i=e.split("\n"),l="";return i.forEach((e,i)=>{let r=0===i?0:i*o.fontSize*o.lineHeight;l+=`<text
      x="${t}" y="${n+o.fontSize}" dy="${r}"
      font-family="${o.fontFamily}"
      font-size="${o.fontSize}"
      fill="${o.textColor}">${e}</text>`}),l}function y(e,t,n,o,i){return`<line
      x1="${e}" y1="${t}"
      x2="${n}" y2="${o}"
      stroke="${i.strokeColor}"
      stroke-width="${i.strokeWidth}"
    />`}function x(e,t,n){return`<g transform="translate(${e}, ${t})">${n}</g>`}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("spdInput"),t=document.getElementById("svgOutput"),n=document.getElementById("fileInput"),o=document.getElementById("downloadButton"),i=document.getElementById("downloadSvgButton"),l=()=>{let n=e.value;try{let e=a.parse(n);t.innerHTML=function(e,t){let n={...u,...void 0};if(!e)return"";let o=c(e,n),i=o.width+n.margin.left+n.margin.right,l=o.height+n.margin.top+n.margin.bottom,r="<svg ";return r+=`width="${i}" height="${l}" `,r+=`viewBox="0 0 ${i} ${l}" `,r+='xmlns="http://www.w3.org/2000/svg">',r+='<rect x="0" y="0" ',r+=`width="${i}" height="${l}" `,r+=`fill="${n.backgroundColor}"/>`,r+=x(n.margin.left,n.margin.top,o.svg),r+="</svg>"}(e)}catch(e){t.innerHTML=`<p style="color: red;">Error: ${e.message}</p>`,console.error("SPD conversion error:",e)}};e.addEventListener("input",l),e.addEventListener("keydown",t=>{if("Tab"===t.key){t.preventDefault();let n=e.selectionStart,o=e.selectionEnd;e.value=e.value.substring(0,n)+"	"+e.value.substring(o),e.selectionStart=e.selectionEnd=n+1,l()}}),n.addEventListener("change",t=>{let n=t.target.files?.[0];if(n){let t=new FileReader;t.onload=t=>{e.value=t.target?.result,l()},t.readAsText(n)}}),o.addEventListener("click",()=>{let t=e.value,n=prompt("ダウンロードするファイル名を入力してください:","edited_spd.spd");if(null===n)return;n.endsWith(".spd")||(n+=".spd");let o=new Blob([t],{type:"text/plain"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download=n,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}),i.addEventListener("click",()=>{let e=t.innerHTML;if(!e)return void alert("SVGが生成されていません。");let n=prompt("ダウンロードするSVGファイル名を入力してください:","output.svg");if(null===n)return;n.endsWith(".svg")||(n+=".svg");let o=new Blob([e],{type:"image/svg+xml"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download=n,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}),e.value=`:terminal START

#\u{30ED}\u{30B8}\u{30C3}\u{30AF}\u{3092}\u{8A18}\u{8FF0}\u{3057}\u{3066}\u{304F}\u{3060}\u{3055}\u{3044}
\u{30ED}\u{30B8}\u{30C3}\u{30AF}

:terminal END`,l()});
//# sourceMappingURL=web.957ebc9d.js.map
